[gd_scene load_steps=4 format=2]

[ext_resource path="res://Graphics/UI/Title.png" type="Texture" id=1]
[ext_resource path="res://Resources/UI/DefaultFont.tres" type="DynamicFont" id=2]

[sub_resource type="GDScript" id=1]
resource_name = "LoginScreen"
script/source = "extends Node2D

onready var message = $Label

func _ready():
	Network.connect(\"error\", self, \"on_error\")
	Network.connect(\"log_in\", self, \"on_log_in\")

func on_log_in():
	Network.account = $Login.text
	get_tree().current_scene = Com.game
	queue_free()

func _on_Login_pressed():
	Network.send_data(Packet.new(Packet.TYPE.LOGIN).add_string($Login.text).add_string($Password.text))

func _on_Register_pressed():
	Network.send_data(Packet.new(Packet.TYPE.REGISTER).add_string($Login.text).add_string($Password.text))

func on_error(code):
	match code:
		ERR_FILE_NOT_FOUND:
			show_message(\"Failed to log in: user doesn't exist.\", Color.red)
		ERR_FILE_NO_PERMISSION:
			show_message(\"Failed to log in: wrong password.\", Color.red)
		ERR_BUSY:
			show_message(\"Failed to log in: user already online.\", Color.red)
		
		ERR_FILE_ALREADY_IN_USE:
			show_message(\"Registration failed: user already exists.\", Color.red)
		OK:
			show_message(\"Registered sucessfully!\", Color.green)

func show_message(_message, color):
	message.text = _message
	message.modulate = color"

[node name="LoginScreen" type="Node2D"]
script = SubResource( 1 )

[node name="Background" type="Sprite" parent="."]
position = Vector2( 413.364, 278.414 )
scale = Vector2( 2, 2 )
texture = ExtResource( 1 )

[node name="Login" type="LineEdit" parent="."]
margin_left = 322.0
margin_top = 255.0
margin_right = 439.0
margin_bottom = 279.0
size_flags_horizontal = 2
size_flags_vertical = 2
text = "a"
placeholder_text = "login"

[node name="Password" type="LineEdit" parent="."]
margin_left = 322.0
margin_top = 297.0
margin_right = 440.0
margin_bottom = 321.0
size_flags_horizontal = 2
size_flags_vertical = 2
text = "a"
secret = true
placeholder_text = "password"

[node name="Log-in" type="Button" parent="."]
margin_left = 291.0
margin_top = 353.0
margin_right = 351.0
margin_bottom = 373.0
size_flags_horizontal = 2
size_flags_vertical = 2
text = "Login"

[node name="Register" type="Button" parent="."]
margin_left = 408.0
margin_top = 354.0
margin_right = 472.0
margin_bottom = 374.0
size_flags_horizontal = 2
size_flags_vertical = 2
text = "Register"

[node name="Label" type="Label" parent="."]
margin_left = 250.0
margin_top = 210.0
margin_right = 516.0
margin_bottom = 227.0
custom_fonts/font = ExtResource( 2 )

[connection signal="pressed" from="Log-in" to="." method="_on_Login_pressed"]
[connection signal="pressed" from="Register" to="." method="_on_Register_pressed"]
